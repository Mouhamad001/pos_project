language = "bash"

# This single `run` command will be executed when you press the "Run" button.
# It performs all necessary steps: installs dependencies, initializes the database,
# builds the frontend, and finally starts the server.
run = """
set -e

echo "--- Installing backend dependencies ---"
python -m pip install -r backend/requirements.txt

echo "--- Initializing database (this will fix the login error) ---"
python backend/init_db.py

echo "--- Installing frontend dependencies ---"
(cd frontend && npm install)

echo "--- Building frontend ---"
(cd frontend && npm run build)

echo "--- Starting backend server ---"
(cd backend && uvicorn main:app --host 0.0.0.0 --port 8000)
"""

# The [deployment] section is for when you use Replit's formal deployment feature.
[deployment]
run = ["sh", "-c", "cd backend && uvicorn main:app --host 0.0.0.0 --port 8000"]
build = ["sh", "-c", "python -m pip install -r backend/requirements.txt && python backend/init_db.py && cd frontend && npm install && npm run build"] 